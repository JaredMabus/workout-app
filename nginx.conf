worker_processes auto;

events {
    worker_connections 1024;
}

http {
    # Reverse proxy's backend servers 
    # upstream workout-app {
    #     server workout-app-prod-container:8080;
    # }

    server {
        listen 80;
        # server_name liftx.tech www.liftx.tech;
        server_name _;

        # Redirect all HTTP requests to HTTPS with a 301 Moved Permanently response.
        return 301 https://$host$request_uri;
    }

    # Listen on port 443 for HTTPS requests
    server {
        listen 443 ssl http2;
        # server_name liftx.tech www.liftx.tech;
        server_name _;

        # SSL certificate configuration
        ssl_certificate /etc/letsencrypt/live/liftx.tech/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/liftx.tech/privkey.pem;


        # Reverse proxy to workout-app running pm2 on port 8080
    #     location / {
    #         proxy_pass http://workout-app;
    #         proxy_set_header Host $host;
    #         proxy_set_header X-Real-IP $remote_addr;
    #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #         proxy_set_header X-Forwarded-Proto $scheme;
    #  }
    }

    # Enable gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;


}